<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Resident Dashboard - SocietyPro</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      href="https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
  </head>
  <body class="dashboard-body">
    <div class="dashboard-container">
      <aside class="sidebar">
        <div class="logo">
          <i class="ri-home-smile-2-line"></i> ResidentPanel
        </div>

        <ul class="menu">
          <li>
            <a href="/user/dashboard" class="active">
              <i class="ri-dashboard-line"></i> My Overview
            </a>
          </li>
          <li>
            <a href="/user/complaints">
              <i class="ri-feedback-line"></i> Complaints
            </a>
          </li>
          <li>
            <a href="/profile">
              <i class="ri-user-settings-line"></i> My Profile
            </a>
          </li>
        </ul>

        <a href="/logout" class="logout-btn">
          <i class="ri-logout-box-line"></i> Logout
        </a>
      </aside>

      <main class="main-content">
        <div class="header-section">
          <div class="header-title">
            <h1>Welcome Home</h1>
            <p>Track your maintenance payments and society updates.</p>
          </div>
        </div>

        <div
          class="stats-banner"
          style="
            background: transparent;
            border: none;
            padding: 0;
            gap: 20px;
            justify-content: flex-start;
          "
        >
          <div
            class="feature-card"
            style="text-align: left; padding: 20px; min-width: 250px"
          >
            <div
              class="icon"
              style="
                font-size: 24px;
                color: var(--primary-orange);
                margin-bottom: 5px;
              "
            >
              <i class="ri-wallet-3-line"></i>
            </div>
            <h3 style="font-size: 14px; color: #888; margin-bottom: 5px">
              Total Dues
            </h3>
            <div
              class="stat-number"
              id="totalPendingDisplay"
              style="font-size: 28px"
            >
              Calculating...
            </div>
          </div>

          <div
            class="feature-card"
            style="text-align: left; padding: 20px; min-width: 250px"
          >
            <div
              class="icon"
              style="font-size: 24px; color: #ef4444; margin-bottom: 5px"
            >
              <i class="ri-file-warning-line"></i>
            </div>
            <h3 style="font-size: 14px; color: #888; margin-bottom: 5px">
              Unpaid Bills
            </h3>
            <div
              class="stat-number"
              id="unpaidCountDisplay"
              style="font-size: 28px"
            >
              0
            </div>
          </div>
        </div>

        <h3 class="section-title" style="margin-top: 40px">
          My Invoice History
        </h3>

        <div class="cards">
          {% if bills %} {% for b in bills %}
          <div
            class="card bill-card"
            data-amount="{{ b[0] }}"
            data-status="{{ b[1] }}"
          >
            <div class="card-header">
              <span>INVOICE #00{{ loop.index }}</span>
              <i class="ri-article-line"></i>
            </div>

            <h3>Monthly Maintenance</h3>

            <div class="card-amount">₹ {{ b[0] }}</div>

            <div
              style="
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-top: 10px;
              "
            >
              <span
                class="status {% if b[1] == 'Paid' %}paid{% else %}unpaid{% endif %}"
              >
                {{ b[1] }}
              </span>

              {% if b[1] == 'Unpaid' %}
              <button
                style="
                  padding: 6px 12px;
                  font-size: 12px;
                  background: white;
                  color: black;
                  border: none;
                  border-radius: 4px;
                  cursor: pointer;
                "
              >
                Pay Now <i class="ri-arrow-right-line"></i>
              </button>
              {% else %}
              <span style="font-size: 12px; color: #10b981">
                <i class="ri-checkbox-circle-line"></i> Cleared
              </span>
              {% endif %}
            </div>
          </div>
          {% endfor %} {% else %}
          <p style="color: #666; padding: 20px">
            No invoices found for your account.
          </p>
          {% endif %}
        </div>
      </main>
    </div>

    <script>
      document.addEventListener("DOMContentLoaded", () => {
        let totalDue = 0;
        let pendingCount = 0;

        // Select all bill cards
        const bills = document.querySelectorAll(".bill-card");

        bills.forEach((card) => {
          // Read data attributes set in the HTML loop
          const amount = parseFloat(card.getAttribute("data-amount"));
          const status = card.getAttribute("data-status");

          // Calculate only if status is Unpaid
          if (status === "Unpaid" && !isNaN(amount)) {
            totalDue += amount;
            pendingCount++;
          }
        });

        // Update the UI
        document.getElementById("totalPendingDisplay").innerText =
          "₹ " + totalDue.toLocaleString("en-IN");
        document.getElementById("unpaidCountDisplay").innerText = pendingCount;
      });
    </script>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
  </body>
</html>
