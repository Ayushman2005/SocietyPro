<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Admin Dashboard - SocietyPro</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="{{ url_for('static', filename='style.css') }}"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css"
      rel="stylesheet"
    />
  </head>
  <body class="dashboard-body">
    <div class="dashboard-container">
      <aside class="sidebar">
        <div class="logo"><i class="ri-building-2-line"></i> AdminPanel</div>
        <ul class="menu">
          <li>
            <a href="/admin/dashboard" class="active"
              ><i class="ri-dashboard-line"></i> Dashboard</a
            >
          </li>
          <li>
            <a href="/admin/tenants"><i class="ri-user-line"></i> Tenants</a>
          </li>
          <li>
            <a href="/admin/invoices"
              ><i class="ri-file-list-3-line"></i> Invoices</a
            >
          </li>
          <li>
            <a href="/admin/visitors"
              ><i class="ri-shield-user-line"></i> Visitors</a
            >
          </li>
          <li>
            <a href="/admin/bookings"
              ><i class="ri-calendar-check-line"></i> Bookings</a
            >
          </li>
          <li>
            <a href="/admin/polls"
              ><i class="ri-bar-chart-box-line"></i> Polls</a
            >
          </li>
          <li>
            <a href="/admin/notices"
              ><i class="ri-notification-3-line"></i> Notices</a
            >
          </li>
          <li>
            <a href="/admin/complaints"
              ><i class="ri-feedback-line"></i> Complaints</a
            >
          </li>
          <li>
            <a href="/admin/settings"
              ><i class="ri-settings-4-line"></i> Settings</a
            >
          </li>
        </ul>
        <a href="/logout" class="logout-btn"
          ><i class="ri-logout-box-line"></i> Logout</a
        >
      </aside>

      <main class="main-content">
        <div class="header-section">
          <div class="header-title">
            <h1>Overview</h1>
            <p>Welcome back, Admin. Here is what's happening today.</p>
          </div>
        </div>
        <div class="fund-card-compact">
          <div class="fund-info">
            <div class="fund-header">
              <span class="fund-title">TOTAL FUND</span>
            </div>
            <h2 class="fund-amount">₹ {{ "{:,.0f}".format(total_fund) }}</h2>
          </div>

          <form action="/admin/update_fund" method="POST" class="fund-form">
            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}" />
            <div class="input-group">
              <input
                type="number"
                name="amount"
                placeholder="Update fund..."
                step="0.01"
                required
              />
              <button type="submit"><i class="ri-save-line"></i></button>
            </div>
          </form>
        </div>

        <div class="content-grid">
          <div class="bills-section">
            <h3 class="section-title">Recent Invoices</h3>
            <div class="cards">
              {% for b in bills %}
              <div
                class="card"
                data-amount="{{ b[2] }}"
                data-status="{{ b[3] }}"
              >
                <div class="card-header">
                  <span>#INV-{{ b[0] }}</span>
                  <div class="actions">
                    <a
                      href="/admin/download_invoice/{{ b[0] }}"
                      title="Download Invoice"
                      style="
                        color: var(--primary-orange);
                        font-size: 18px;
                        margin-right: 10px;
                      "
                    >
                      <i class="ri-download-cloud-2-line"></i>
                    </a>

                    <form
                      action="/admin/delete_bill/{{ b[0] }}"
                      method="POST"
                      style="display: inline"
                    >
                      <input
                        type="hidden"
                        name="csrf_token"
                        value="{{ csrf_token() }}"
                      />
                      <button
                        type="submit"
                        onclick="
                          return confirm(
                            'Are you sure you want to delete this invoice permanently?',
                          );
                        "
                        title="Delete Invoice"
                        style="
                          background: none;
                          border: none;
                          color: #ef4444;
                          font-size: 18px;
                          cursor: pointer;
                        "
                      >
                        <i class="ri-delete-bin-line"></i>
                      </button>
                    </form>
                  </div>
                </div>
                <h3 style="font-size: 14px; color: #ccc; margin-bottom: 5px">
                  {{ b[1] }}
                </h3>
                <h2 class="invoice-amount">₹ {{ b[2] }}</h2>
                <span
                  class="status {% if b[3]=='Paid' %}paid{% else %}unpaid{% endif %}"
                  >{{ b[3] }}</span
                >
              </div>
              {% endfor %}
            </div>
          </div>

          <div class="form-section">
            <h3 class="section-title">Create New Bill</h3>
            <div class="form-box">
              <form method="post" action="/admin/add_bill">
                <input
                  type="hidden"
                  name="csrf_token"
                  value="{{ csrf_token() }}"
                />

                <label
                  style="
                    font-size: 13px;
                    color: #94a3b8;
                    margin-bottom: 8px;
                    display: block;
                  "
                  >Select Resident</label
                >

                <div class="select-wrapper">
                  <select name="user_id" required class="custom-select">
                    <option value="" disabled selected>
                      Select a Resident...
                    </option>
                    {% for u in users %}
                    <option value="{{ u[0] }}">{{ u[1] }} | {{ u[2] }}</option>
                    {% endfor %}
                  </select>
                </div>

                <label
                  style="
                    font-size: 13px;
                    color: #94a3b8;
                    margin-top: 15px;
                    display: block;
                  "
                  >Amount (INR)</label
                >
                <div class="input-group-modern">
                  <span class="currency-symbol">₹</span>
                  <input
                    type="number"
                    name="amount"
                    placeholder="5000"
                    required
                  />
                </div>

                <button type="submit" class="generate-btn">
                  <i class="ri-flash-lightning-fill"></i> Generate Invoice
                </button>
              </form>
            </div>
          </div>
        </div>
      </main>
    </div>
    <script src="{{ url_for('static', filename='script.js') }}"></script>
  </body>
</html>
